<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Google Resources Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .debug-section {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .api-response {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
        }

        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 4px;
        }

        .warning {
            color: #856404;
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
        }

        button {
            padding: 12px 24px;
            margin: 10px 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .clear-btn {
            background: #6c757d;
        }

        .clear-btn:hover {
            background: #545b62;
        }

        .test-btn {
            background: #28a745;
        }

        .test-btn:hover {
            background: #1e7e34;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç Comprehensive Google Resources Debug Tool</h1>

        <div class="debug-section">
            <h2>üöÄ Quick Actions</h2>
            <button class="test-btn" onclick="runAllTests()">Run All Tests</button>
            <button class="clear-btn" onclick="clearAllCaches()">Clear All Caches</button>
            <button onclick="checkNetworkTab()">Open Network Tab Guide</button>
        </div>

        <div class="grid">
            <div class="debug-section">
                <h2>üåê API Response Test</h2>
                <button onclick="testResourcesAPI()">Test Resources API</button>
                <button onclick="testMultipleRequests()">Test Multiple Requests</button>
                <div id="api-status" class="status loading" style="display: none;">Testing API...</div>
                <div id="api-response" class="api-response"></div>
            </div>

            <div class="debug-section">
                <h2>üíæ Storage Analysis</h2>
                <button onclick="analyzeStorage()">Analyze All Storage</button>
                <button onclick="searchStorageForGNU()">Search for GNU Make</button>
                <div id="storage-analysis"></div>
            </div>
        </div>

        <div class="grid">
            <div class="debug-section">
                <h2>üîó Network Analysis</h2>
                <button onclick="testDifferentEndpoints()">Test Different Endpoints</button>
                <button onclick="checkCORS()">Check CORS Issues</button>
                <div id="network-analysis"></div>
            </div>

            <div class="debug-section">
                <h2>üß™ Data Comparison</h2>
                <button onclick="compareData()">Compare API vs Display</button>
                <button onclick="simulateFrontendFlow()">Simulate Frontend Flow</button>
                <div id="data-comparison"></div>
            </div>
        </div>

        <div class="debug-section">
            <h2>üìä Live Monitoring</h2>
            <button onclick="startLiveMonitoring()">Start Live Monitoring</button>
            <button onclick="stopLiveMonitoring()">Stop Live Monitoring</button>
            <div id="live-monitoring"></div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        async function runAllTests() {
            console.log('üöÄ Running all tests...');
            await testResourcesAPI();
            await analyzeStorage();
            await testDifferentEndpoints();
            await compareData();
        }

        async function testResourcesAPI() {
            const statusDiv = document.getElementById('api-status');
            const responseDiv = document.getElementById('api-response');

            statusDiv.style.display = 'block';
            statusDiv.className = 'status loading';
            statusDiv.textContent = 'Testing Resources API...';

            try {
                const formData = new FormData();
                formData.append('food_choice_index', 'rice');

                console.log('üåê Making API call to http://34.170.200.225:7017/resources');
                const startTime = Date.now();

                const response = await fetch('http://34.170.200.225:7017/resources', {
                    method: 'POST',
                    body: formData,
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('üì¶ API Response received:', data);

                // Analyze the response
                const analysis = analyzeAPIResponse(data);

                statusDiv.className = 'status success';
                statusDiv.textContent = `‚úÖ API Success (${responseTime}ms)`;

                responseDiv.innerHTML = `
                    <h3>üìä Response Analysis</h3>
                    ${analysis.summary}
                    <h4>üîç Detailed Response:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;

            } catch (error) {
                console.error('‚ùå API Error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå API Error: ${error.message}`;
                responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function analyzeAPIResponse(data) {
            const analysis = {
                hasGoogleSearch: !!data.GoogleSearch,
                hasYoutubeSearch: !!data.YoutubeSearch,
                googleCount: data.GoogleSearch ? data.GoogleSearch.length : 0,
                youtubeCount: data.YoutubeSearch ? data.YoutubeSearch.length : 0,
                hasGNU: false,
                hasCookingContent: false,
                summary: ''
            };

            const responseString = JSON.stringify(data).toLowerCase();
            analysis.hasGNU = responseString.includes('gnu make');
            analysis.hasCookingContent = responseString.includes('cook') || responseString.includes('recipe') || responseString.includes('rice');

            let summary = `
                <div class="${analysis.hasGNU ? 'error' : 'success'}">
                    <strong>GNU Make Content:</strong> ${analysis.hasGNU ? '‚ùå FOUND' : '‚úÖ NOT FOUND'}
                </div>
                <div class="${analysis.hasCookingContent ? 'success' : 'warning'}">
                    <strong>Cooking Content:</strong> ${analysis.hasCookingContent ? '‚úÖ FOUND' : '‚ö†Ô∏è NOT FOUND'}
                </div>
                <div>
                    <strong>GoogleSearch Results:</strong> ${analysis.googleCount}
                </div>
                <div>
                    <strong>YouTubeSearch Results:</strong> ${analysis.youtubeCount}
                </div>
            `;

            if (analysis.hasGNU) {
                summary += `<div class="error">üö® CRITICAL ISSUE: API is returning GNU make content instead of cooking content!</div>`;
            }

            analysis.summary = summary;
            return analysis;
        }

        async function testMultipleRequests() {
            const responseDiv = document.getElementById('api-response');
            responseDiv.innerHTML = '<h3>üîÑ Testing Multiple Requests...</h3>';

            const testQueries = ['rice', 'chicken', 'pasta', 'bread'];
            const results = [];

            for (const query of testQueries) {
                try {
                    const formData = new FormData();
                    formData.append('food_choice_index', query);

                    const response = await fetch('http://34.170.200.225:7017/resources', {
                        method: 'POST',
                        body: formData,
                    });

                    const data = await response.json();
                    const hasGNU = JSON.stringify(data).toLowerCase().includes('gnu make');

                    results.push({
                        query,
                        success: response.ok,
                        hasGNU,
                        googleCount: data.GoogleSearch ? data.GoogleSearch.length : 0
                    });
                } catch (error) {
                    results.push({
                        query,
                        success: false,
                        error: error.message,
                        hasGNU: false
                    });
                }
            }

            let html = '<h3>üìä Multiple Request Results:</h3><table border="1" style="width:100%; border-collapse: collapse;"><tr><th>Query</th><th>Success</th><th>Has GNU Make</th><th>Google Results</th></tr>';
            results.forEach(result => {
                html += `<tr>
                    <td>${result.query}</td>
                    <td class="${result.success ? 'success' : 'error'}">${result.success ? '‚úÖ' : '‚ùå'}</td>
                    <td class="${result.hasGNU ? 'error' : 'success'}">${result.hasGNU ? 'üö® YES' : '‚úÖ No'}</td>
                    <td>${result.googleCount || 'N/A'}</td>
                </tr>`;
            });
            html += '</table>';

            responseDiv.innerHTML = html;
        }

        function analyzeStorage() {
            const analysisDiv = document.getElementById('storage-analysis');
            const storage = {
                localStorage: {},
                sessionStorage: {},
                cookies: document.cookie
            };

            // Analyze localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                storage.localStorage[key] = value;
            }

            // Analyze sessionStorage
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                storage.sessionStorage[key] = value;
            }

            // Search for GNU make content
            const storageString = JSON.stringify(storage).toLowerCase();
            const hasGNU = storageString.includes('gnu make');

            analysisDiv.innerHTML = `
                <h3>üíæ Storage Analysis</h3>
                <div class="${hasGNU ? 'error' : 'success'}">
                    <strong>GNU Make in Storage:</strong> ${hasGNU ? 'üö® FOUND' : '‚úÖ NOT FOUND'}
                </div>
                <h4>LocalStorage (${Object.keys(storage.localStorage).length} items):</h4>
                <pre>${JSON.stringify(storage.localStorage, null, 2)}</pre>
                <h4>SessionStorage (${Object.keys(storage.sessionStorage).length} items):</h4>
                <pre>${JSON.stringify(storage.sessionStorage, null, 2)}</pre>
                <h4>Cookies:</h4>
                <pre>${storage.cookies || 'No cookies'}</pre>
            `;
        }

        function searchStorageForGNU() {
            const analysisDiv = document.getElementById('storage-analysis');
            const results = [];

            // Search localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                if (value && value.toLowerCase().includes('gnu make')) {
                    results.push({ type: 'localStorage', key, value });
                }
            }

            // Search sessionStorage
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                if (value && value.toLowerCase().includes('gnu make')) {
                    results.push({ type: 'sessionStorage', key, value });
                }
            }

            if (results.length > 0) {
                analysisDiv.innerHTML = `
                    <h3>üö® GNU Make Found in Storage!</h3>
                    ${results.map(result => `
                        <div class="error">
                            <strong>${result.type} - ${result.key}:</strong><br>
                            <pre>${result.value}</pre>
                        </div>
                    `).join('')}
                `;
            } else {
                analysisDiv.innerHTML = `
                    <h3>‚úÖ No GNU Make Found in Storage</h3>
                    <div class="success">Storage is clean of GNU make content.</div>
                `;
            }
        }

        async function testDifferentEndpoints() {
            const networkDiv = document.getElementById('network-analysis');
            networkDiv.innerHTML = '<h3>üîó Testing Different Endpoints...</h3>';

            const endpoints = [
                'http://34.170.200.225:7017/resources',
                'http://localhost:7017/resources',
                'http://34.170.200.225:5001/api/food_detection/resources'
            ];

            const results = [];

            for (const endpoint of endpoints) {
                try {
                    const formData = new FormData();
                    formData.append('food_choice_index', 'rice');

                    const response = await fetch(endpoint, {
                        method: 'POST',
                        body: formData,
                    });

                    const data = await response.json();
                    const hasGNU = JSON.stringify(data).toLowerCase().includes('gnu make');

                    results.push({
                        endpoint,
                        success: response.ok,
                        status: response.status,
                        hasGNU,
                        googleCount: data.GoogleSearch ? data.GoogleSearch.length : 0
                    });
                } catch (error) {
                    results.push({
                        endpoint,
                        success: false,
                        error: error.message,
                        hasGNU: false
                    });
                }
            }

            let html = '<h3>üåê Endpoint Test Results:</h3><table border="1" style="width:100%; border-collapse: collapse;"><tr><th>Endpoint</th><th>Status</th><th>Has GNU Make</th><th>Google Results</th></tr>';
            results.forEach(result => {
                html += `<tr>
                    <td style="font-size: 12px;">${result.endpoint}</td>
                    <td class="${result.success ? 'success' : 'error'}">${result.success ? `‚úÖ ${result.status}` : '‚ùå Error'}</td>
                    <td class="${result.hasGNU ? 'error' : 'success'}">${result.hasGNU ? 'üö® YES' : '‚úÖ No'}</td>
                    <td>${result.googleCount || 'N/A'}</td>
                </tr>`;
            });
            html += '</table>';

            networkDiv.innerHTML = html;
        }

        function checkCORS() {
            const networkDiv = document.getElementById('network-analysis');
            networkDiv.innerHTML = `
                <h3>üîí CORS Analysis</h3>
                <div class="warning">
                    <strong>Note:</strong> If you see CORS errors in the browser console, 
                    this might indicate the API server is not running or not configured properly.
                </div>
                <p>Check the browser's Network tab for:</p>
                <ul>
                    <li>CORS preflight requests (OPTIONS)</li>
                    <li>Actual POST requests</li>
                    <li>Response headers</li>
                    <li>Any error responses</li>
                </ul>
            `;
        }

        function compareData() {
            const comparisonDiv = document.getElementById('data-comparison');
            comparisonDiv.innerHTML = `
                <h3>üîÑ Data Flow Analysis</h3>
                <div class="success">
                    <strong>Expected Flow:</strong><br>
                    1. Frontend calls http://34.170.200.225:7017/resources<br>
                    2. API returns cooking-related Google search results<br>
                    3. Frontend displays cooking content<br>
                    <br>
                    <strong>Actual Issue:</strong><br>
                    Frontend is displaying GNU make content instead of cooking content
                </div>
                <h4>üîç Possible Causes:</h4>
                <ul>
                    <li>API server on port 7017 is returning wrong data</li>
                    <li>Browser cache is serving old responses</li>
                    <li>Multiple API endpoints with different responses</li>
                    <li>Frontend is calling wrong endpoint</li>
                    <li>Data transformation is corrupting the response</li>
                </ul>
            `;
        }

        function simulateFrontendFlow() {
            const comparisonDiv = document.getElementById('data-comparison');
            comparisonDiv.innerHTML = '<h3>üé≠ Simulating Frontend Flow...</h3>';

            // Simulate the exact frontend flow
            const formData = new FormData();
            formData.append('food_choice_index', 'rice');

            fetch('http://34.170.200.225:7017/resources', {
                method: 'POST',
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    // Simulate the frontend processing
                    const googleResults = (data.GoogleSearch || []).flat().map((item: any) => ({
                        title: item.title,
                        description: item.description,
                        url: item.link,
                        image: item.image || '',
                    }));

                    comparisonDiv.innerHTML = `
                    <h3>üé≠ Frontend Flow Simulation</h3>
                    <div class="success">‚úÖ API call successful</div>
                    <h4>üì¶ Raw API Response:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <h4>üîÑ Processed Google Results:</h4>
                    <pre>${JSON.stringify(googleResults, null, 2)}</pre>
                    <div class="${JSON.stringify(googleResults).toLowerCase().includes('gnu make') ? 'error' : 'success'}">
                        <strong>Processed Results Contain GNU Make:</strong> 
                        ${JSON.stringify(googleResults).toLowerCase().includes('gnu make') ? 'üö® YES' : '‚úÖ No'}
                    </div>
                `;
                })
                .catch(error => {
                    comparisonDiv.innerHTML = `
                    <h3>üé≠ Frontend Flow Simulation</h3>
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
                });
        }

        function startLiveMonitoring() {
            const monitoringDiv = document.getElementById('live-monitoring');
            monitoringDiv.innerHTML = '<h3>üìä Live Monitoring Started</h3><div id="monitoring-log"></div>';

            monitoringInterval = setInterval(async () => {
                try {
                    const formData = new FormData();
                    formData.append('food_choice_index', 'rice');

                    const response = await fetch('http://34.170.200.225:7017/resources', {
                        method: 'POST',
                        body: formData,
                    });

                    const data = await response.json();
                    const hasGNU = JSON.stringify(data).toLowerCase().includes('gnu make');
                    const timestamp = new Date().toLocaleTimeString();

                    const logDiv = document.getElementById('monitoring-log');
                    const status = hasGNU ? 'üö® GNU MAKE DETECTED' : '‚úÖ Clean';
                    const className = hasGNU ? 'error' : 'success';

                    logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${status} - Google Results: ${data.GoogleSearch ? data.GoogleSearch.length : 0}</div>`;
                    logDiv.scrollTop = logDiv.scrollHeight;

                } catch (error) {
                    const timestamp = new Date().toLocaleTimeString();
                    const logDiv = document.getElementById('monitoring-log');
                    logDiv.innerHTML += `<div class="error">[${timestamp}] ‚ùå Error: ${error.message}</div>`;
                    logDiv.scrollTop = logDiv.scrollHeight;
                }
            }, 5000); // Check every 5 seconds
        }

        function stopLiveMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                document.getElementById('live-monitoring').innerHTML = '<h3>üìä Live Monitoring Stopped</h3>';
            }
        }

        function clearAllCaches() {
            // Clear localStorage
            localStorage.clear();
            // Clear sessionStorage
            sessionStorage.clear();
            // Clear any cached API responses
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            // Force reload
            alert('All caches cleared! The page will reload.');
            window.location.reload();
        }

        function checkNetworkTab() {
            alert(`üîç To check the Network tab:
1. Open Developer Tools (F12)
2. Go to the Network tab
3. Make a request in your app
4. Look for:
   - Requests to port 7017
   - Response content
   - Any CORS errors
   - Response headers
5. Check if the actual response contains GNU make content`);
        }

        // Auto-run basic tests on page load
        window.onload = function () {
            console.log('üîç Debug tool loaded. Starting basic analysis...');
            analyzeStorage();
        };
    </script>
</body>

</html>